<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Admin Dashboard - Ronz Pizza</title>
  <link rel="stylesheet" href="admin.css">
</head>
<body>
  <h1>üçï Ronz Pizza Admin Dashboard</h1>

  <!-- Users Section -->
  <section>
    <h2>Users</h2>
    <table border="1"> 
      <thead>
        <tr><th>ID</th><th>Name</th><th>Email</th><th>Created At</th><th>Actions</th></tr>
      </thead>
      <tbody id="usersTable"></tbody>
    </table>
    <button onclick="showAddUser()">Add User</button>
  </section>

  <!-- Orders Section -->
  <section>
    <h2>Orders</h2>
    <table border="1">
      <thead>
        <tr><th>ID</th><th>User</th><th>Total</th><th>Status</th><th>Created At</th></tr>
      </thead>
      <tbody id="ordersTable"></tbody>
    </table>
  </section>

  <!-- Items Section -->
  <section>
    <h2>Menu Items</h2>
    <table border="1">
      <thead>
        <tr><th>ID</th><th>Name</th><th>Price</th><th>Available</th><th>Actions</th></tr>
      </thead>
      <tbody id="itemsTable"></tbody>
    </table>
    <button onclick="showAddItem()">Add Item</button>
  </section>

  <script>
    // ========= USERS =========
    function loadUsers() {
      fetch("get_users.php")
        .then(res => res.json())
        .then(data => {
          const tbody = document.getElementById("usersTable");
          tbody.innerHTML = "";
          data.users.forEach(u => {
            const tr = document.createElement("tr");
            tr.innerHTML = `
              <td>${u.id}</td>
              <td>${u.name}</td>
              <td>${u.email}</td>
              <td>${u.created_at}</td>
              <td><button onclick="deleteUser(${u.id})">Delete</button></td>
            `;
            tbody.appendChild(tr);
          });
        });
    }

    function showAddUser() {
      const name = prompt("Enter user name:");
      const email = prompt("Enter user email:");
      const password = prompt("Enter password:");
      if (!name || !email || !password) return;
      fetch("add_user.php", {
        method: "POST",
        headers: {"Content-Type": "application/json"},
        body: JSON.stringify({ name, email, password })
      }).then(() => loadUsers());
    }

    function deleteUser(id) {
      if (!confirm("Delete this user?")) return;
      fetch("delete_user.php", {
        method: "POST",
        headers: {"Content-Type": "application/json"},
        body: JSON.stringify({ id })
      }).then(() => loadUsers());
    }

    // ========= ORDERS =========
    function loadOrders() {
      fetch("get_orders.php")
        .then(res => res.json())
        .then(data => {
          const tbody = document.getElementById("ordersTable");
          tbody.innerHTML = "";
          data.orders.forEach(o => {
            const tr = document.createElement("tr");
            tr.innerHTML = `
              <td>${o.id}</td>
              <td>${o.user}</td>
              <td>Ksh.${o.total}</td>
              <td>${o.status}</td>
              <td>${o.created_at}</td>
            `;
            tbody.appendChild(tr);
          });
        });
    }

    // ========= ITEMS =========
    function loadItems() {
      fetch("get_items.php")
        .then(res => res.json())
        .then(data => {
          const tbody = document.getElementById("itemsTable");
          tbody.innerHTML = "";
          data.items.forEach(i => {
            const tr = document.createElement("tr");
            tr.innerHTML = `
              <td>${i.id}</td>
              <td>${i.name}</td>
              <td>Ksh.${i.price}</td>
              <td>${i.available == 1 ? "Yes" : "No"}</td>
              <td>
                <button onclick="editItem(${i.id}, '${i.name}', ${i.price}, ${i.available})">Edit</button>
                <button onclick="deleteItem(${i.id})">Delete</button>
              </td>
            `;
            tbody.appendChild(tr);
          });
        });
    }

    function showAddItem() {
      const name = prompt("Enter item name:");
      const price = prompt("Enter item price:");
      if (!name || !price) return;
      fetch("add_item.php", {
        method: "POST",
        headers: {"Content-Type": "application/json"},
        body: JSON.stringify({ name, price })
      }).then(() => loadItems());
    }

    function editItem(id, name, price, available) {
      const newName = prompt(`Edit name for item ${id}:`, name);
      if (newName === null) return;
      const newPrice = prompt(`Edit price for ${newName}:`, price);
      if (newPrice === null) return;
      const newAvailable = confirm(`Make ${newName} available? (OK = Yes, Cancel = No)`);

      fetch("update_item.php", {
        method: "POST",
        headers: {"Content-Type": "application/json"},
        body: JSON.stringify({
          id,
          name: newName,
          price: newPrice,
          available: newAvailable ? 1 : 0
        })
      }).then(() => loadItems());
    }

    function deleteItem(id) {
      if (!confirm("Delete this item?")) return;
      fetch("delete_item.php", {
        method: "POST",
        headers: {"Content-Type": "application/json"},
        body: JSON.stringify({ id })
      }).then(() => loadItems());
    }

    // ========= INITIAL LOAD =========
    loadUsers();
    loadOrders();
    loadItems();
  </script>
</body>
</html>
